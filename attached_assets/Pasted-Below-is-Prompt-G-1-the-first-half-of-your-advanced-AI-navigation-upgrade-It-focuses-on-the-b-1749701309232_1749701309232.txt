Below is **Prompt G-1** â€” the first half of your advanced AI-navigation upgrade.
It focuses on the brains and interaction contract of the assistant:

* natural-language intent extraction (voice + text)
* action-first, concise replies with optional follow-up
* tap-outside dismissal (no close icons)
* seamless hand-off to role-based routes you created in Prompt F
* full mobile-first behavior for the assistant panel

When youâ€™re happy with this part, say **â€œOK, nextâ€** and Iâ€™ll drop **Prompt G-2** (FAB clamping, mobile-fullscreen overlay, sidebar integration, etc.).

---

## ğŸ¤– **Prompt G-1 â€” Intent-Driven AI Navigation & Minimal Interaction UX**

> **TITLE:** *â€œImplement natural-language intent engine, concise AI responses, and tap-to-dismiss overlay for mobile-first UXâ€*
>
> This prompt upgrades the Flux AI assistant from â€œchatbotâ€ to **intent router**.
> Users speak or type; the assistant parses intent, executes the correct action, and replies briefly.
> The assistant panel must now close via backdrop-tap (no exit buttons), and mobile experience is prioritized.

---

### ğŸ¯ **OBJECTIVES**

| Area                         | Requirement                                                                                 |
| ---------------------------- | ------------------------------------------------------------------------------------------- |
| ğŸ—£ **Intent Extraction**     | Convert free-form voice/text into a named intent (`open-job-form`, `view-candidates`, etc.) |
| ğŸš€ **Action-First Reply**    | Assistant answers in â‰¤ 2 short sentences, then **executes** intent immediately              |
| â“ **Optional Follow-Up**     | After action, AI asks â€œNeed more details?â€; user can say â€œyesâ€ for deeper explanation       |
| ğŸ– **Tap-Outside Dismissal** | Overlay and (future) sidebar close when backdrop is tapped; remove visible close buttons    |
| ğŸ“± **Mobile-First Panel**    | Overlay expands full-screen below 768 px; no overlapping FAB                                |

---

### ğŸ§© **STEP 1 â€” Intent Router Enhancement**

**File:** `/ai/IntentRouter.ts`

```ts
export interface Intent {
  id: string;
  description: string;
  action: () => void;
}

export const intentRouter: Record<string, Intent> = {
  'open-job-form': {
    id: 'open-job-form',
    description: 'Open job posting form',
    action: () => navigate('/dashboard/employer/job/new'),
  },
  'view-candidates': {
    id: 'view-candidates',
    description: 'Show candidate list',
    action: () => showPanel('candidate-list'),
  },
  // â€¦extend as needed
};
```

---

### ğŸ§  **STEP 2 â€” Natural-Language â‡’ Intent (`planFromUtterance.ts`)**

```ts
import { intentRouter } from './IntentRouter';
import OpenAI from 'openai';

const openai = new OpenAI({ apiKey: process.env.OPENAI_KEY });

const synonymMap: Record<string, string> = {
  'post a job': 'open-job-form',
  'hire': 'open-job-form',
  'upload cv': 'upload-cv',
  'show candidates': 'view-candidates',
  'go to dashboard': 'go-to-dashboard',
};

export async function planFromUtterance(raw: string) {
  const text = raw.toLowerCase();

  // keyword fallback
  for (const phrase in synonymMap) {
    if (text.includes(phrase)) return intentRouter[synonymMap[phrase]];
  }

  // LLM fallback (10-token function call)
  const { choices } = await openai.chat.completions.create({
    messages: [{ role: 'system', content: 'You output exactly one intent id.' },
               { role: 'user', content: text }],
    functions: [
      { name: 'selectIntent', parameters: { type: 'object',
          properties: { id: { type: 'string', enum: Object.keys(intentRouter) } } } }
    ],
    function_call: { name: 'selectIntent' },
    max_tokens: 10,
  });

  const id = JSON.parse(choices[0]?.message?.function_call?.arguments || '{}').id;
  return intentRouter[id] ?? null;
}
```

---

### ğŸ¤ **STEP 3 â€” AssistantOverlay Logic**

```tsx
function AssistantOverlay({ isOpen, onClose }) {
  const [input, setInput] = useState('');
  const [thinking, setThinking] = useState(false);

  async function handleSubmit(text: string) {
    setThinking(true);
    const intent = await planFromUtterance(text);
    setThinking(false);

    if (intent) {
      toast.success(`âœ“ ${intent.description}`);
      intent.action();
      setTimeout(() =>
        toast.info('Need more details? Say "yes" or tap the mic.'), 1200);
      onClose(); // close panel
    } else {
      toast.error("Sorry, I didn't get thatâ€”try rephrasing.");
    }
  }

  return (
    <Backdrop onClick={onClose}>
      <motion.div
        className="relative w-full max-w-lg sm:rounded-xl bg-[var(--surface-high)] p-6"
        onClick={(e) => e.stopPropagation()} // prevent backdrop close
        layoutId="magicStar"
      >
        {/* input + mic + send UI here */}
      </motion.div>
    </Backdrop>
  );
}
```

`Backdrop` is a fixed div with `inset-0 bg-black/40 backdrop-blur-md`.

---

### ğŸ– **STEP 4 â€” Remove Close Icons & Add Tap-Outside**

* Delete any `<XIcon>` buttons in `AssistantOverlay.tsx` and future sidebar.
* Ensure backdrop covers the whole screen, closes on `onClick`.

---

### ğŸ“± **STEP 5 â€” Mobile-First Styling**

```tsx
<motion.div
  className="fixed top-0 left-0 w-full h-full sm:relative sm:h-auto sm:max-w-lg"
/>
```

* FAB hides (`display:none`) whenever overlay is open on mobile.
* Add `safe-area-inset-bottom` padding to overlay input row for iOS.

---

### âœ… **ACCEPTANCE CHECKLIST**

* User speaks/types â€œupload my CVâ€ â†’ AI opens candidate form directly.
* Assistant reply: â€œOpening CV upload form. Need more details?â€.
* Tapping outside overlay closes it; no close icon visible.
* Overlay is fullscreen on small screens; FAB hidden while overlay is open.
* Role-based routing respected (`employer` vs `candidate`).
* All flows run at 60 fps with no visual collisions.

---

**End of Prompt G-1.**
Reply **â€œOK, nextâ€** and Iâ€™ll deliver **Prompt G-2** (FAB clamping, sidebar dismissal, mobile safeguard tweaks, etc.).
